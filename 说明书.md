# 图书管理系统

## 系统需求分析

### 目的

- 开发一个功能完善、操作简单、界面友好的图书管理系统，实现图书和用户的增删查改、借阅、归还、记录查询、热门书籍和活跃用户统计等功能，提高图书馆的管理效率和服务质量。

### 系统需求

#### 图书管理

- **新建图书**
  - 输入图书信息，包括名称、作者、分类、关键词、简介。
- **修改图书信息**
  - 输入需要修改的图书名称，显示图书信息，输入修改后的信息。
- **删除图书**
  - 输入需要删除的图书名称，确认删除。
- **模糊查询图书**
  - 输入搜索词，显示查询结果。

#### 用户管理

- **新建用户**
  - 输入用户信息，包括用户名。
- **修改用户信息**
  - 输入需要修改的用户名，输入新用户名。
- **删除用户**
  - 输入需要删除的用户名，确认删除。
- **模糊查询用户**
  - 输入搜索词，显示查询结果。

#### 借阅管理

- **图书借阅**
  - 输入图书名称、用户名，确认借阅。
- **图书归还**
  - 输入图书名称、用户名，确认归还。
- **借阅信息查询**
  - 输入用户姓名，显示借阅信息。

#### 数据管理

- **存储图书数据**
  - 每本书用一个txt文件存储，包括名称、作者、分类、关键词、简介、借阅状态、借阅次数。
- **存储用户数据**
  - 每个用户用一个txt文件存储，包括用户名、借阅记录（借阅图书、借阅时间、归还时间）。
- **查看十大热门书籍**
  - 统计图书借阅次数，获取借阅次数最多的十本书。
- **查看十大活跃用户**
  - 统计用户借阅次数，获取借阅次数最多的十个用户。
- **清空数据**

#### 图形化界面

- 提供操作提示和帮助信息，支持中文显示。

#### 输入输出

- **输入验证**
  - 对用户输入进行验证，确保输入合法。包括非空验证、格式验证、范围验证。
- **输出显示**
  - 显示操作结果，包括成功、失败、错误信息。

## 总体设计

图书管理系统包含四个主要功能，分别为图书增删改查、用户增删改查、借阅归还、数据统计。具体的功能设计及流程如下：

### 系统功能设计及模块图

```mermaid
graph LR
    A[开始] --> B{添加书籍}
    B --> C[输入书名、作者、分类、关键词、简介]
    C --> D[判断书籍是否存在]
    D -- 存在 --> E[提示书籍已存在]
    D -- 不存在 --> F[保存书籍信息]
    F --> G[结束]

    A --> H{删除书籍}
    H --> I[输入书名]
    I --> J[判断书籍是否存在]
    J -- 存在 --> K[确认删除]
    K -- 是 --> L[删除书籍]
    L --> M[结束]
    K -- 否 --> N[取消删除]
    N --> M

    A --> O{查找书籍}
    O --> P[输入搜索词]
    P --> Q[查询书籍信息]
    Q --> R[显示书籍列表]
    R --> S[结束]

    A --> T{编辑书籍}
    T --> U[输入书名]
    U --> V[判断书籍是否存在]
    V -- 存在 --> W[输入新信息]
    W --> X[保存新信息]
    X --> Y[结束]
    V -- 不存在 --> Z[提示书籍不存在]
    Z --> Y

    A --> AA{添加用户}
    AA --> AB[输入用户名]
    AB --> AC[判断用户是否存在]
    AC -- 存在 --> AD[提示用户已存在]
    AC -- 不存在 --> AE[保存用户信息]
    AE --> AF[结束]

    A --> AG{删除用户}
    AG --> AH[输入用户名]
    AH --> AI[判断用户是否存在]
    AI -- 存在 --> AJ[确认删除]
    AJ -- 是 --> AK[删除用户]
    AK --> AL[结束]
    AJ -- 否 --> AM[取消删除]
    AM --> AL

    A --> AN{查找用户}
    AN --> AO[输入用户名]
    AO --> AP[查询用户信息]
    AP --> AQ[显示用户列表]
    AQ --> AR[结束]

    A --> AS{编辑用户}
    AS --> AT[输入用户名]
    AT --> AU[判断用户是否存在]
    AU -- 存在 --> AV[输入新信息]
    AV --> AW[保存新信息]
    AW --> AX[结束]
    AU -- 不存在 --> AY[提示用户不存在]
    AY --> AX

    A --> AZ{图书借阅}
    AZ --> BA[输入书名、用户名]
    BA --> BB[判断书籍和用户是否存在]
    BB -- 存在 --> BC[判断书籍是否已借出]
    BC -- 已借出 --> BD[提示书籍已借出]
    BC -- 未借出 --> BE[借阅书籍]
    BE --> BF[结束]
    BB -- 不存在 --> BG[提示书籍或用户不存在]
    BG --> BF

    A --> BH{图书归还}
    BH --> BI[输入书名、用户名]
    BI --> BJ[判断书籍和用户是否存在]
    BJ -- 存在 --> BK[判断是否已借阅]
    BK -- 未借阅 --> BL[提示未借阅书籍]
    BK -- 已借阅 --> BM[归还书籍]
    BM --> BN[结束]
    BJ -- 不存在 --> BO[提示书籍或用户不存在]
    BO --> BN

    A --> BP{借阅记录}
    BP --> BQ[输入用户名]
    BQ --> BR[判断用户是否存在]
    BR -- 存在 --> BS[显示借阅记录]
    BS --> BT[结束]
    BR -- 不存在 --> BU[提示用户不存在]
    BU --> BT

    A --> BV{十大热门书籍}
    BV --> BW[查询热门书籍]
    BW --> BX[显示书籍列表]
    BX --> BY[结束]

    A --> BZ{十大活跃用户}
    BZ --> CA[查询活跃用户]
    CA --> CB[显示用户列表]
    CB --> CC[结束]

    A --> CD{删除所有书籍}
    CD --> CE[确认删除]
    CE -- 是 --> CF[删除所有书籍]
    CF --> CG[结束]
    CE -- 否 --> CH[取消删除]
    CH --> CG

    A --> CI{删除所有用户}
    CI --> CJ[确认删除]
    CJ -- 是 --> CK[删除所有用户]
    CK --> CL[结束]
    CJ -- 否 --> CM[取消删除]
    CM --> CL

    A --> CN{退出系统}
    CN --> CO[结束]
```

## 详细设计

### 数据文件

本系统采用文本文件存储图书和用户数据，数据格式遵循一定的规范，确保数据的准确性和易读性。

#### 文件结构

- **图书数据**

  - 存储在`./data/book/`目录下，文件名与图书名称相同（已转换为`GBK`编码），扩展名为`.txt`。

- **用户数据**

  - 存储在`./data/user/`目录下，文件名与用户名相同（已转换为`GBK`编码），扩展名为`.txt`。

#### 数据格式

- **图书数据**

  - 每条数据占用一行。
  - 字段顺序为：标题、作者、分类、关键词、简介、借出状态（1 表示已借出，0 表示未借出）、借出次数。
  - 字段为`UTF-8`编码。

- **用户数据**

  - 每条数据占用一行。
  - 字段顺序为：书名、借书时间、还书时间、是否已归还（1 表示已归还，0 表示未归还）。
  - 字段为`UTF-8`编码。

#### 示例

- **图书数据文件**
  文件名：`./data/book/三国演义.txt`

  ```txt
  三国演义
  罗贯中
  历史小说
  三国
  汉末群雄逐鹿中原
  0
  50
  ```

- **用户数据文件**

  文件名：`./data/user/张三.txt`

  ```txt
  三国演义
  2023-04-01 15:18:24
  2023-04-10 15:18:24
  1
  西游记
  2023-04-10 15:28:24
  
  0
  ```

### 类的层次图

```mermaid
graph TD
    B(Book) -->|继承| BA(Base)
    U(User) -->|继承| BA
    M(Manager) --> |继承| BM(BookManager)
    M --> |继承| UM(UserManager)
    G(GUI) --> M
    L(Library) --> G
```

### 类图

```mermaid
classDiagram
    class Book {
        +title: string
        +author: string
        +category: string
        +keywords: string
        +summary: string
        +borrowTimes: int
        +isBorrowed: bool
        --Book(string, string, string, string, string)
        --Book(const Book &)
        +~Book()
        +Add() const: int
        +Save() const
        +Delete() const: int
        +Edit() const: int
    }
    class User {
        +name: string
        +borrowRecords: vector<Record>
        +borrowTimes: int
        --User(string)
        --User(const User &)
        +~User()
        +Add() const: int
        +Save() const
        +Delete() const: int
        +Edit() const: int
    }
    class Base {
        <<abstract>>
        +Add() const: virtual int
        +Save() const: virtual void
        +Delete() const: virtual int
        +Edit() const: virtual int
    }
    Book <|-- Base
    User <|-- Base
    class BookManager {
        +getBook(string) const: Book
        +searchBook(string) const: vector<Book>
        +tenHotBooks() const: vector<Book>
        +deleteAllBooks() const: int
    }
    class UserManager {
        +getUser(string) const: User
        +searchUser(string) const: vector<User>
        +tenActiveUsers() const: vector<User>
        +deleteAllUsers() const: int
    }
    class Manager {
        +getCurrentDateTime() const: string
        +borrowBook(string, string) const: int
        +returnBook(string, string) const: int
    }
    class GUI {
        +ShowMenu() const
        +RemoveBlank(string) const: string
        +DisplayBook(Book) const
        +AddBook() const
        +DeleteBook() const
        +SearchBook() const
        +EditBook() const
        +DisplayUser(User) const
        +AddUser() const
        +DeleteUser() const
        +SearchUser() const
        +EditUser() const
        +BorrowBook() const
        +ReturnBook() const
        +BorrowRecord() const
        +TenHotBooks() const
        +TenActiveUsers() const
        +DeleteAllBooks() const
        +DeleteAllUsers() const
        +Exit() const
        +Error() const
    }
    class Library {
        +CheckDirectory() const
    }
    Manager <|-- BookManager
    Manager <|-- UserManager
    GUI <|-- Manager
    Library <|-- GUI
```
